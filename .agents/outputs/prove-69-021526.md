---
issue: 69
agent: PROVE
date: 2026-02-15
status: PASS
tests_passed: 52
tests_failed: 0
regressions: 0
full_suite: 506 passed
---

# PROVE: Issue #69 -- FormRouter and Plugin API Surface

## Executive Summary

All 52 targeted tests pass (33 in `test_router.py`, 19 in `test_api.py`). The full test suite passes with 506 tests, zero failures, zero regressions. All acceptance criteria are met. The three PLAN-CHECK blocking issues (B1: idempotency untouched, B2: uses `compute_ingest_key` not `compute_form_ingest_key`, B3: `__init__.py` only adds router exports) were correctly applied by PATCH.

## Verification Results

### Gate 1: Ruff Lint

| Command | Result |
|---------|--------|
| `ruff check router.py api.py` | All checks passed |

### Gate 2: Targeted Tests

| Suite | Result |
|-------|--------|
| `test_router.py` + `test_api.py` (52 tests) | 52 passed in 0.84s |

### Gate 3: Full Suite

| Suite | Result |
|-------|--------|
| `packages/ingestkit-forms/tests/` | 506 passed, 2 warnings in 39.56s |
| Regressions | 0 |

### Import Verification

`from ingestkit_forms import FormRouter, create_default_router` -- OK.

## Acceptance Criteria

| # | Criterion | Status |
|---|-----------|--------|
| 1 | Full pipeline works: match -> extract -> output | PASS |
| 2 | All 10 API operations functional (6 existing + 4 new) | PASS |
| 3 | Source detection: .xlsx->ExcelCell, .pdf+fields->NativePDF, .pdf-fields->OCR, image->OCR | PASS |
| 4 | Idempotency keys are deterministic | PASS |
| 5 | Graceful fallthrough for unmatched documents (returns None) | PASS |
| 6 | render_document returns PNG bytes | PASS |
| 7 | preview_extraction works without persistence | PASS |
| 8 | Unit tests for full pipeline, each API operation, source detection, idempotency | PASS |
| 9 | No concrete backend imports in router/api | PASS |
| 10 | Uses `compute_ingest_key` from core (not `compute_form_ingest_key`) | PASS |

## Comparison with PATCH

PATCH reported 491 tests passed. Current run shows 506 passed. The increase is expected -- other issues added tests between PATCH execution and this PROVE run. Zero failures and zero regressions confirm no breakage.

PATCH reported 25 new tests (18 router + 7 API). The actual test count in `test_router.py` is 33 (18 from issue #69 + 15 from issue #72 which added `match_document`, `try_match`, and structured logging tests). The `test_api.py` file has 19 tests total (12 pre-existing + 7 new). All counts are consistent.

## Compliance Checklist

- [x] Structural subtyping via Protocol (no ABC)
- [x] Backend protocols imported under `TYPE_CHECKING` only
- [x] Logger namespace: `ingestkit_forms`
- [x] PII-safe logging verified (dedicated test: `test_pii_safe_logging`)
- [x] `from __future__ import annotations` present in all files
- [x] `__init__.py` exports only `FormRouter` and `create_default_router` (idempotency already exported)
- [x] `compute_ingest_key` called directly (not wrapped in `compute_form_ingest_key`)
- [x] All tests marked `@pytest.mark.unit`

## Issues Found

None.

## Recommendation

**APPROVED** -- Implementation is complete, all tests pass, no regressions. Ready for PR.

AGENT_RETURN: .agents/outputs/prove-69-021526.md
