---
issue: 46
title: "Implement ExecutionBackend protocol and distributed backend"
agent: PROVE
date: 2026-02-14
status: PASS
tests_passed: 829
tests_failed: 1
regressions: 0
---

# PROVE Artifact: Issue #46 -- ExecutionBackend Protocol and Distributed Backend

## Executive Summary

All verification gates pass. The 27 new unit tests in `test_execution.py` pass in 0.10s. The full test suite runs 829 passed / 1 failed / 5 skipped. The single failure (`test_path_a_throughput_slo`) is a pre-existing hardware-dependent benchmark SLO unrelated to this change. Zero regressions. All 15 acceptance criteria from the PLAN are verified. PLAN-CHECK Issue #1 (model_dump() conversion) is correctly applied at execution.py:107-108.

## Verification Results

### Test Execution

| Suite | Result | Duration |
|-------|--------|----------|
| `test_execution.py` (27 tests) | 27 passed | 0.10s |
| Full `packages/ingestkit-pdf/tests/` | 829 passed, 1 failed, 5 skipped, 1 xfailed | 16.56s |

The single failure is `test_benchmark.py::TestThroughputBenchmarks::test_path_a_throughput_slo` -- a hardware-dependent throughput SLO (9.6 pages/sec vs 50 SLO target). This test predates Issue #46 and fails due to the environment, not any code change.

### Lint Check

```
ruff check packages/ingestkit-pdf/src/ingestkit_pdf/execution.py
All checks passed!
```

### Import Verification

```
python3 -c "from ingestkit_pdf import ExecutionBackend, LocalExecutionBackend, DistributedExecutionBackend; print('OK')"
# OK

python3 -c "from ingestkit_pdf.protocols import ExecutionBackend; print('OK')"
# OK

python3 -c "from ingestkit_pdf.config import PDFProcessorConfig; c = PDFProcessorConfig(); assert c.execution_backend == 'local'; assert c.execution_max_workers == 4; assert c.execution_queue_url is None; print('OK')"
# OK

python3 -c "from ingestkit_pdf import ExecutionError; print('OK')"
# OK
```

## Acceptance Criteria

| # | Criterion | Status |
|---|-----------|--------|
| 1 | `ExecutionBackend` Protocol with `submit()` and `get_result()` matching SPEC 18.3 | PASS |
| 2 | `LocalExecutionBackend` wraps ProcessPoolExecutor logic | PASS |
| 3 | `DistributedExecutionBackend` is stub raising `NotImplementedError` | PASS |
| 4 | Both backends satisfy `isinstance(..., ExecutionBackend)` at runtime | PASS |
| 5 | `PDFProcessorConfig` has `execution_backend`, `execution_max_workers`, `execution_queue_url` | PASS |
| 6 | `PDFRouter.__init__()` accepts optional `execution` parameter | PASS |
| 7 | `PDFRouter.process_batch()` delegates to execution backend | PASS |
| 8 | Default behavior (no `execution` param) matches current `process_batch()` behavior | PASS |
| 9 | Rollback to local is config-only | PASS |
| 10 | 3 new error codes: `E_EXECUTION_TIMEOUT`, `E_EXECUTION_SUBMIT`, `E_EXECUTION_NOT_FOUND` | PASS |
| 11 | `ExecutionBackend` re-exported from `protocols.py` | PASS |
| 12 | All 3 classes + `ExecutionError` exported from `__init__.py` | PASS |
| 13 | Unit tests pass | PASS (27/27) |
| 14 | No regressions in existing tests | PASS |
| 15 | All tests are `@pytest.mark.unit` -- no external services required | PASS |

## PLAN-CHECK Issue Verification

| Issue | Resolution | Status |
|-------|-----------|--------|
| #1 (MEDIUM): model_dump() conversion | `execute_all()` calls `config.model_dump()` at line 108, with explicit comment referencing PLAN-CHECK Issue #1 | PASS |
| #2 (LOW): hasattr duck-typing for execute_all | Used with comment at router.py:505 | PASS |
| #3 (LOW): create_default_router import bug | Not fixed (correctly out of scope) | PASS |

## Comparison with PATCH

All PATCH claims verified. No discrepancies found.

- PATCH reported 27 tests added: confirmed (27 collected, 27 passed)
- PATCH reported 829 total passing (full suite): confirmed (829 passed)
- PATCH reported 0 regressions: confirmed
- PATCH reported `ExecutionError` deviation from PLAN: confirmed (correct design -- IngestError is a Pydantic model, not raisable)

## Compliance Checklist

| Rule | Status |
|------|--------|
| `typing.Protocol` with `@runtime_checkable` (no ABC) | PASS |
| Pydantic v2 `BaseModel` for data models | PASS |
| Logger name `"ingestkit_pdf"` | PASS |
| Structural subtyping (Protocol, not ABC) | PASS |
| Error codes from `ErrorCode` enum | PASS |
| All tests marked `@pytest.mark.unit` | PASS |
| No concrete backends inside package | PASS (DistributedExecutionBackend is a stub, not concrete) |

## Issues Found

None.

## Recommendation

**APPROVED** -- Ready for PR.

AGENT_RETURN: .agents/outputs/prove-46-021426.md
