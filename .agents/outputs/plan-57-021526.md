---
issue: 57
agent: PLAN
date: 2026-02-15
complexity: COMPLEX
stack: backend
depends_on: map-57-021526.md
---

# PLAN: Issue #57 -- Implement Form Data Models (Pydantic v2)

## 1. Executive Summary

This plan implements 22 types (3 enums, 16 new models, 1 extended model, 2 reused from core) for the `ingestkit-forms` package. The package does not exist yet, so we must scaffold the minimal directory structure (`pyproject.toml`, `__init__.py`, `errors.py`, `models.py`). All models follow the spec (sections 5, 6, 8, 9, 10, 12) with one mandatory Pydantic v2 migration fix: replacing `FormTemplate.Config.json_encoders` with `@field_serializer`. The `FormChunkMetadata` extends `BaseChunkMetadata` from core; `FormWrittenArtifacts` is NOT needed (spec §10.2 shows `WrittenArtifacts` with `db_row_ids` inline -- we extend core instead). `FormIngestError` extends `BaseIngestError` with form-specific context fields.

---

## 2. File-by-File Implementation Plan

### 2.1 Package Scaffolding (4 files)

These files must exist before `models.py` can import from core or define errors.

#### File: `packages/ingestkit-forms/pyproject.toml` (NEW)

Minimal package definition following `ingestkit-excel/pyproject.toml` pattern.

```toml
[build-system]
requires = ["setuptools>=68.0"]
build-backend = "setuptools.backends._legacy:_Backend"

[project]
name = "ingestkit-forms"
version = "0.1.0"
description = "Form template extraction plugin for ingestkit"
requires-python = ">=3.10"
dependencies = [
    "pydantic>=2.0",
    "ingestkit-core",
]

[project.optional-dependencies]
dev = [
    "pytest>=7.0",
    "pytest-cov",
]

[tool.setuptools.packages.find]
where = ["src"]
```

#### File: `packages/ingestkit-forms/src/ingestkit_forms/__init__.py` (NEW)

```python
"""ingestkit-forms: template-driven form extraction plugin for ingestkit."""
```

#### File: `packages/ingestkit-forms/src/ingestkit_forms/errors.py` (NEW)

Contains `FormErrorCode` enum (37 codes from spec §12.1) and `FormIngestError` model (extends `BaseIngestError` from core, adds 6 form-specific fields from spec §12.2).

**FormErrorCode** -- all 37 values from spec §12.1:
- Template: `E_FORM_TEMPLATE_NOT_FOUND`, `E_FORM_TEMPLATE_INVALID`, `E_FORM_TEMPLATE_VERSION_CONFLICT`, `E_FORM_TEMPLATE_STORE_UNAVAILABLE`
- Matching: `E_FORM_NO_MATCH`, `E_FORM_FINGERPRINT_FAILED`
- Extraction: `E_FORM_EXTRACTION_FAILED`, `E_FORM_EXTRACTION_LOW_CONFIDENCE`, `E_FORM_EXTRACTION_TIMEOUT`, `E_FORM_UNSUPPORTED_FORMAT`, `E_FORM_OCR_FAILED`, `E_FORM_NATIVE_FIELDS_UNAVAILABLE`
- Output: `E_FORM_DB_SCHEMA_EVOLUTION_FAILED`, `E_FORM_DB_WRITE_FAILED`, `E_FORM_CHUNK_WRITE_FAILED`
- Dual-write: `E_FORM_DUAL_WRITE_PARTIAL`
- Manual override: `E_FORM_FORMAT_MISMATCH`
- VLM: `E_FORM_VLM_UNAVAILABLE`, `E_FORM_VLM_TIMEOUT`
- Security: `E_FORM_FILE_TOO_LARGE`, `E_FORM_FILE_CORRUPT`
- Backend (reused codes): `E_BACKEND_VECTOR_TIMEOUT`, `E_BACKEND_VECTOR_CONNECT`, `E_BACKEND_DB_TIMEOUT`, `E_BACKEND_DB_CONNECT`, `E_BACKEND_EMBED_TIMEOUT`, `E_BACKEND_EMBED_CONNECT`
- Warnings: `W_FORM_FIELD_LOW_CONFIDENCE`, `W_FORM_FIELD_VALIDATION_FAILED`, `W_FORM_FIELD_MISSING_REQUIRED`, `W_FORM_FIELD_TYPE_COERCION`, `W_FORM_FIELDS_FLATTENED`, `W_FORM_MATCH_BELOW_THRESHOLD`, `W_FORM_MULTI_MATCH`, `W_FORM_OCR_DEGRADED`, `W_FORM_MERGED_CELL_RESOLVED`, `W_FORM_SCHEMA_EVOLVED`, `W_FORM_ROLLBACK_FAILED`, `W_FORM_PARTIAL_WRITE`, `W_FORM_VLM_FALLBACK_USED`, `W_FORM_VLM_BUDGET_EXHAUSTED`

**FormIngestError(BaseIngestError)** -- spec §12.2:
- Inherits: `code: str`, `message: str`, `stage: str | None`, `recoverable: bool`
- Narrows: `code: FormErrorCode` (same pattern as Excel's `IngestError`)
- Adds: `template_id: str | None = None`, `template_version: int | None = None`, `field_name: str | None = None`, `page_number: int | None = None`
- Diagnostic context (P1): `candidate_matches: list[dict] | None = None`, `backend_operation_id: str | None = None`, `fallback_reason: str | None = None`

#### File: `packages/ingestkit-forms/tests/__init__.py` (NEW)

Empty file.

---

### 2.2 Main Models File

#### File: `packages/ingestkit-forms/src/ingestkit_forms/models.py` (NEW)

**Imports:**

```python
from __future__ import annotations

import uuid
from datetime import datetime, timezone
from enum import Enum

from pydantic import BaseModel, ConfigDict, Field, field_serializer, model_validator

from ingestkit_core.models import (
    BaseChunkMetadata,
    EmbedStageResult,
    IngestKey,
    WrittenArtifacts,
)
from ingestkit_forms.errors import FormIngestError
```

**Section 1: Enumerations (3 enums)**

All enums use `(str, Enum)` pattern. **ENUM_VALUE risk**: all values are lowercase strings.

| Enum | Values (Python name = string value) |
|------|------|
| `SourceFormat` | `PDF = "pdf"`, `XLSX = "xlsx"`, `IMAGE = "image"` |
| `FieldType` | `TEXT = "text"`, `NUMBER = "number"`, `DATE = "date"`, `CHECKBOX = "checkbox"`, `RADIO = "radio"`, `SIGNATURE = "signature"`, `DROPDOWN = "dropdown"` |
| `DualWriteMode` | `BEST_EFFORT = "best_effort"`, `STRICT_ATOMIC = "strict_atomic"` |

**Section 2: Template Models (4 models)**

**`BoundingBox(BaseModel)`** -- spec §5.1 lines 325-336:
| Field | Type | Constraint |
|-------|------|------------|
| `x` | `float` | `Field(ge=0.0, le=1.0)` |
| `y` | `float` | `Field(ge=0.0, le=1.0)` |
| `width` | `float` | `Field(gt=0.0, le=1.0)` |
| `height` | `float` | `Field(gt=0.0, le=1.0)` |

**`CellAddress(BaseModel)`** -- spec §5.1 lines 339-350:
| Field | Type | Default |
|-------|------|---------|
| `cell` | `str` | required |
| `sheet_name` | `str \| None` | `None` |

**`FieldMapping(BaseModel)`** -- spec §5.1 lines 353-399 + §5.2 lines 470-492:
| Field | Type | Default/Constraint |
|-------|------|-------------------|
| `field_id` | `str` | `default_factory=lambda: str(uuid.uuid4())` |
| `field_name` | `str` | required |
| `field_label` | `str` | required |
| `field_type` | `FieldType` | required |
| `page_number` | `int` | `Field(ge=0)` |
| `region` | `BoundingBox \| None` | `None` |
| `cell_address` | `CellAddress \| None` | `None` |
| `required` | `bool` | `False` |
| `validation_pattern` | `str \| None` | `None` |
| `default_value` | `str \| None` | `None` |
| `options` | `list[str] \| None` | `None` |
| `extraction_hint` | `str \| None` | `None` |

**Validator** -- `@model_validator(mode="after")`:
```python
@model_validator(mode="after")
def _validate_address_type(self) -> FieldMapping:
    if self.region is None and self.cell_address is None:
        raise ValueError(
            f"Field '{self.field_name}' must have either 'region' "
            f"(for PDF/image) or 'cell_address' (for Excel)."
        )
    if self.region is not None and self.cell_address is not None:
        raise ValueError(
            f"Field '{self.field_name}' cannot have both 'region' and "
            f"'cell_address'. Use one addressing scheme."
        )
    return self
```

**`FormTemplate(BaseModel)`** -- spec §5.1 lines 402-455:
| Field | Type | Default/Constraint |
|-------|------|-------------------|
| `template_id` | `str` | `default_factory=lambda: str(uuid.uuid4())` |
| `name` | `str` | required |
| `description` | `str` | `""` |
| `version` | `int` | `Field(default=1, ge=1)` |
| `source_format` | `SourceFormat` | required |
| `page_count` | `int` | `Field(ge=1)` |
| `fields` | `list[FieldMapping]` | `Field(min_length=1)` |
| `layout_fingerprint` | `bytes \| None` | `None` |
| `thumbnail` | `bytes \| None` | `None` |
| `created_at` | `datetime` | `default_factory=lambda: datetime.now(timezone.utc)` |
| `updated_at` | `datetime` | `default_factory=lambda: datetime.now(timezone.utc)` |
| `created_by` | `str` | `"system"` |
| `tenant_id` | `str \| None` | `None` |

**Pydantic v2 fix** (replaces spec's v1 `class Config: json_encoders`):
```python
@field_serializer("layout_fingerprint", "thumbnail")
@classmethod
def _serialize_bytes(cls, v: bytes | None) -> str | None:
    return v.hex() if v else None
```

**Section 3: Matching Models (2 models)**

**`TemplateMatch(BaseModel)`** -- spec §6.2 lines 620-638:
| Field | Type | Constraint |
|-------|------|------------|
| `template_id` | `str` | required |
| `template_name` | `str` | required |
| `template_version` | `int` | required |
| `confidence` | `float` | `Field(ge=0.0, le=1.0)` |
| `per_page_confidence` | `list[float]` | required |
| `matched_features` | `list[str]` | required |

**`FormIngestRequest(BaseModel)`** -- spec §6.3 lines 654-669:
| Field | Type | Default |
|-------|------|---------|
| `file_path` | `str` | required |
| `template_id` | `str \| None` | `None` |
| `template_version` | `int \| None` | `None` |
| `tenant_id` | `str \| None` | `None` |
| `source_uri` | `str \| None` | `None` |
| `metadata` | `dict[str, str] \| None` | `None` |

**Section 4: Extraction Result Models (2 models)**

**`ExtractedField(BaseModel)`** -- spec §10.1 lines 1407-1440:
| Field | Type | Default/Constraint |
|-------|------|-------------------|
| `field_id` | `str` | required |
| `field_name` | `str` | required |
| `field_label` | `str` | required |
| `field_type` | `FieldType` | required |
| `value` | `str \| bool \| float \| None` | described |
| `raw_value` | `str \| None` | `None` |
| `confidence` | `float` | `Field(ge=0.0, le=1.0)` |
| `extraction_method` | `str` | required |
| `bounding_box` | `BoundingBox \| None` | `None` |
| `validation_passed` | `bool \| None` | `None` |
| `warnings` | `list[str]` | `[]` |

**`FormExtractionResult(BaseModel)`** -- spec §10.1 lines 1443-1473:
| Field | Type | Default/Constraint |
|-------|------|-------------------|
| `form_id` | `str` | `default_factory=lambda: str(uuid.uuid4())` |
| `template_id` | `str` | required |
| `template_name` | `str` | required |
| `template_version` | `int` | required |
| `source_uri` | `str` | required |
| `source_format` | `str` | required |
| `fields` | `list[ExtractedField]` | required |
| `overall_confidence` | `float` | required |
| `extraction_method` | `str` | required |
| `match_method` | `str` | required |
| `match_confidence` | `float \| None` | `None` |
| `pages_processed` | `int` | required |
| `extraction_duration_seconds` | `float` | required |
| `warnings` | `list[str]` | `[]` |

**Section 5: Chunk Models (2 models)**

**`FormChunkMetadata(BaseChunkMetadata)`** -- spec §8.3 lines 1117-1155:

Extends `BaseChunkMetadata` from core (inherits 13 fields). Overrides/adds:
| Field | Type | Default/Override |
|-------|------|-----------------|
| `ingestion_method` | `str` | `"form_extraction"` (override default) |
| `template_id` | `str` | required (NEW) |
| `template_name` | `str` | required (NEW) |
| `template_version` | `int` | required (NEW) |
| `form_id` | `str` | required (NEW) |
| `field_names` | `list[str]` | required (NEW) |
| `extraction_method` | `str` | required (NEW) |
| `overall_confidence` | `float` | required (NEW) |
| `per_field_confidence` | `dict[str, float]` | required (NEW) |
| `form_date` | `str \| None` | `None` (NEW) |
| `page_numbers` | `list[int]` | required (NEW) |
| `match_method` | `str` | required (NEW) |

Note: Inherits `table_name`, `row_count`, `columns`, `section_title` from core (all `None` by default). These are acceptable to carry even though forms don't use them.

**`FormChunkPayload(BaseModel)`** -- spec §8.4 lines 1161-1167:
| Field | Type |
|-------|------|
| `id` | `str` |
| `text` | `str` |
| `vector` | `list[float]` |
| `metadata` | `FormChunkMetadata` |

**Section 6: Result Models (2 models)**

**`FormWrittenArtifacts(WrittenArtifacts)`** -- extends core with spec §10.2 line 1519:
| Field | Type | Default | Source |
|-------|------|---------|--------|
| `vector_point_ids` | `list[str]` | `[]` | inherited |
| `vector_collection` | `str \| None` | `None` | inherited |
| `db_table_names` | `list[str]` | `[]` | inherited |
| `db_row_ids` | `list[str]` | `[]` | NEW |

**`FormProcessingResult(BaseModel)`** -- spec §10.2 lines 1479-1502:
| Field | Type | Default |
|-------|------|---------|
| `file_path` | `str` | required |
| `ingest_key` | `str` | required |
| `ingest_run_id` | `str` | required |
| `tenant_id` | `str \| None` | `None` |
| `extraction_result` | `FormExtractionResult` | required |
| `embed_result` | `EmbedStageResult \| None` | `None` |
| `chunks_created` | `int` | required |
| `tables_created` | `int` | required |
| `tables` | `list[str]` | required |
| `written` | `FormWrittenArtifacts` | required |
| `errors` | `list[str]` | required |
| `warnings` | `list[str]` | required |
| `error_details` | `list[FormIngestError]` | `[]` |
| `processing_time_seconds` | `float` | required |

Note: `written` uses `FormWrittenArtifacts` (not plain `WrittenArtifacts`) to get `db_row_ids`. `error_details` uses `FormIngestError` (not base `IngestError`).

**`RollbackResult(BaseModel)`** -- spec §8.5 lines 1175-1181:
| Field | Type | Default |
|-------|------|---------|
| `vector_points_deleted` | `int` | `0` |
| `db_rows_deleted` | `int` | `0` |
| `errors` | `list[str]` | `[]` |
| `fully_rolled_back` | `bool` | `True` |

**Section 7: Request/Response Models (3 models)**

**`FormTemplateCreateRequest(BaseModel)`** -- spec §9.2 lines 1360-1372:
| Field | Type | Default |
|-------|------|---------|
| `name` | `str` | required |
| `description` | `str` | `""` |
| `source_format` | `SourceFormat` | required |
| `sample_file_path` | `str` | required |
| `page_count` | `int` | `Field(ge=1)` |
| `fields` | `list[FieldMapping]` | `Field(min_length=1)` |
| `tenant_id` | `str \| None` | `None` |
| `created_by` | `str` | `"system"` |

**`FormTemplateUpdateRequest(BaseModel)`** -- spec §9.2 lines 1375-1385:
| Field | Type | Default |
|-------|------|---------|
| `name` | `str \| None` | `None` |
| `description` | `str \| None` | `None` |
| `sample_file_path` | `str \| None` | `None` |
| `page_count` | `int \| None` | `None` |
| `fields` | `list[FieldMapping] \| None` | `None` |

**`ExtractionPreview(BaseModel)`** -- spec §9.2 lines 1388-1397:
| Field | Type |
|-------|------|
| `template_id` | `str` |
| `template_name` | `str` |
| `template_version` | `int` |
| `fields` | `list[ExtractedField]` |
| `overall_confidence` | `float` |
| `extraction_method` | `str` |
| `warnings` | `list[str]` |

**Section 8: Re-exports**

At bottom of `models.py`, re-export core types for convenience (same pattern as Excel):

```python
# Re-exports from ingestkit-core (for convenience)
__all__ = [
    # Enums
    "SourceFormat", "FieldType", "DualWriteMode",
    # Template
    "BoundingBox", "CellAddress", "FieldMapping", "FormTemplate",
    # Matching
    "TemplateMatch", "FormIngestRequest",
    # Extraction
    "ExtractedField", "FormExtractionResult",
    # Chunks
    "FormChunkMetadata", "FormChunkPayload",
    # Results
    "FormWrittenArtifacts", "FormProcessingResult", "RollbackResult",
    # Request/Response
    "FormTemplateCreateRequest", "FormTemplateUpdateRequest", "ExtractionPreview",
    # Core re-exports
    "IngestKey", "EmbedStageResult", "WrittenArtifacts", "BaseChunkMetadata",
]
```

---

## 3. Key Decisions & Risk Mitigations

### 3.1 ENUM_VALUE Pattern (26% failure rate)

All three enums use lowercase string values:
- `SourceFormat.PDF` = `"pdf"` (NOT `"PDF"`)
- `FieldType.TEXT` = `"text"` (NOT `"TEXT"`)
- `DualWriteMode.BEST_EFFORT` = `"best_effort"` (NOT `"BEST_EFFORT"`)

### 3.2 VERIFICATION_GAP: Pydantic v2 Migration

Spec's `FormTemplate.Config` uses Pydantic v1 `json_encoders`. Implementation uses:
- `@field_serializer("layout_fingerprint", "thumbnail")` for bytes-to-hex serialization
- No `model_config = ConfigDict(...)` needed unless `arbitrary_types_allowed` is required (bytes is a standard type, so not needed)

### 3.3 datetime.utcnow Deprecation

Spec uses `default_factory=datetime.utcnow`. Implementation uses `default_factory=lambda: datetime.now(timezone.utc)` for Python 3.12+ forward compatibility.

### 3.4 FormProcessingResult.written Type

The spec §10.2 shows `written: WrittenArtifacts` with `db_row_ids` on the same class. Since core's `WrittenArtifacts` lacks `db_row_ids`, we create `FormWrittenArtifacts(WrittenArtifacts)` with that field and type `written` as `FormWrittenArtifacts`.

### 3.5 FormIngestError vs BaseIngestError

The spec §12.2 defines `FormIngestError(BaseModel)` which should instead extend `BaseIngestError` to follow the Excel pattern. The `code` field is narrowed from `str` to `FormErrorCode` with `# type: ignore[assignment]`.

---

## 4. Test Plan

### File: `packages/ingestkit-forms/tests/test_models.py` (NEW)

**4.1 Enum Tests** (3 tests)

| Test | What it verifies |
|------|-----------------|
| `test_source_format_values` | `SourceFormat.PDF.value == "pdf"`, `.XLSX.value == "xlsx"`, `.IMAGE.value == "image"`. Asserts lowercase. |
| `test_field_type_values` | All 7 `FieldType` members have lowercase string values. |
| `test_dual_write_mode_values` | `DualWriteMode.BEST_EFFORT.value == "best_effort"`, `.STRICT_ATOMIC.value == "strict_atomic"`. |

**4.2 BoundingBox Tests** (3 tests)

| Test | What it verifies |
|------|-----------------|
| `test_bounding_box_valid` | Accepts valid normalized coordinates (e.g., x=0.1, y=0.2, width=0.5, height=0.3). |
| `test_bounding_box_x_out_of_range` | Rejects x > 1.0 or x < 0.0 (ValidationError). |
| `test_bounding_box_width_zero` | Rejects width=0.0 (constraint is gt=0.0). |

**4.3 FieldMapping Tests** (4 tests)

| Test | What it verifies |
|------|-----------------|
| `test_field_mapping_with_region` | Valid when `region` is set, `cell_address` is None. |
| `test_field_mapping_with_cell_address` | Valid when `cell_address` is set, `region` is None. |
| `test_field_mapping_both_addresses_raises` | `model_validator` raises ValueError when both set. |
| `test_field_mapping_no_address_raises` | `model_validator` raises ValueError when neither set. |

**4.4 FormTemplate Tests** (4 tests)

| Test | What it verifies |
|------|-----------------|
| `test_form_template_defaults` | `template_id` is UUID string, `version` defaults to 1, `created_by` defaults to "system", `created_at`/`updated_at` are populated. |
| `test_form_template_fields_min_length` | Rejects empty `fields` list. |
| `test_form_template_bytes_serialization` | `model_dump(mode="json")` serializes `layout_fingerprint` as hex string. |
| `test_form_template_bytes_none_serialization` | `model_dump(mode="json")` serializes `None` bytes fields as `None`. |

**4.5 Matching Model Tests** (2 tests)

| Test | What it verifies |
|------|-----------------|
| `test_template_match_confidence_bounds` | Rejects confidence > 1.0 or < 0.0. |
| `test_form_ingest_request_optional_fields` | All optional fields default to None. |

**4.6 Extraction Result Tests** (3 tests)

| Test | What it verifies |
|------|-----------------|
| `test_extracted_field_confidence_bounds` | Rejects confidence outside [0.0, 1.0]. |
| `test_extracted_field_union_value_types` | Accepts str, bool, float, None for `value`. |
| `test_form_extraction_result_defaults` | `form_id` auto-generated UUID, `warnings` defaults to empty list. |

**4.7 Chunk Model Tests** (2 tests)

| Test | What it verifies |
|------|-----------------|
| `test_form_chunk_metadata_extends_base` | `FormChunkMetadata` is a subclass of `BaseChunkMetadata`. `ingestion_method` defaults to `"form_extraction"`. |
| `test_form_chunk_payload_structure` | Accepts valid payload with `FormChunkMetadata`. |

**4.8 Result Model Tests** (3 tests)

| Test | What it verifies |
|------|-----------------|
| `test_form_written_artifacts_extends_core` | `FormWrittenArtifacts` is a subclass of `WrittenArtifacts`. Has `db_row_ids` field defaulting to `[]`. |
| `test_form_processing_result_structure` | Constructs valid result with all required fields. |
| `test_rollback_result_defaults` | All fields have expected defaults (0, [], True). |

**4.9 Request/Response Tests** (2 tests)

| Test | What it verifies |
|------|-----------------|
| `test_form_template_create_request_required_fields` | `name`, `source_format`, `sample_file_path` are required. `fields` min_length=1. |
| `test_form_template_update_request_all_optional` | All fields default to None. |

**4.10 Error Model Tests** (2 tests)

| Test | What it verifies |
|------|-----------------|
| `test_form_error_code_values` | Spot-check: `FormErrorCode.E_FORM_TEMPLATE_NOT_FOUND.value == "E_FORM_TEMPLATE_NOT_FOUND"`. |
| `test_form_ingest_error_extends_base` | `FormIngestError` is subclass of `BaseIngestError`. Has form-specific fields (`template_id`, `field_name`, etc.). |

**4.11 Serialization Round-Trip Tests** (2 tests)

| Test | What it verifies |
|------|-----------------|
| `test_form_template_json_round_trip` | `FormTemplate` -> `model_dump(mode="json")` -> `FormTemplate.model_validate(data)` produces equivalent model. |
| `test_form_extraction_result_json_round_trip` | Same round-trip for `FormExtractionResult`. |

**Total: ~30 tests**, all marked `@pytest.mark.unit`.

---

## 5. Implementation Order

1. **Scaffold**: `pyproject.toml`, `__init__.py`, `tests/__init__.py`
2. **Errors**: `errors.py` (FormErrorCode + FormIngestError)
3. **Models**: `models.py` (all 19 new models/enums in spec-defined order)
4. **Tests**: `test_models.py`
5. **Install**: `pip install -e "packages/ingestkit-forms[dev]"` and run tests

---

## 6. Acceptance Criteria

- [ ] Package `ingestkit-forms` is installable with `pip install -e "packages/ingestkit-forms[dev]"`
- [ ] `errors.py` contains `FormErrorCode` (37 codes) and `FormIngestError` (extends `BaseIngestError`)
- [ ] `models.py` contains all 19 new types (3 enums + 16 models)
- [ ] All 3 enums use `(str, Enum)` with lowercase string values
- [ ] `FieldMapping` has `@model_validator(mode="after")` enforcing mutual exclusivity
- [ ] `FormTemplate` uses `@field_serializer` for bytes fields (NOT Pydantic v1 `json_encoders`)
- [ ] `FormTemplate.created_at`/`updated_at` use `datetime.now(timezone.utc)` (NOT `datetime.utcnow`)
- [ ] `FormChunkMetadata` extends `BaseChunkMetadata` from core
- [ ] `FormWrittenArtifacts` extends `WrittenArtifacts` from core with `db_row_ids`
- [ ] `FormIngestError` extends `BaseIngestError` from core with form-specific fields
- [ ] `FormProcessingResult.written` typed as `FormWrittenArtifacts`
- [ ] `FormProcessingResult.error_details` typed as `list[FormIngestError]`
- [ ] Core types re-exported: `IngestKey`, `EmbedStageResult`, `WrittenArtifacts`, `BaseChunkMetadata`
- [ ] All unit tests pass (`pytest packages/ingestkit-forms/tests -m unit`)
- [ ] No regressions in existing `ingestkit-excel` tests
- [ ] Every model/enum has at least one unit test

---

## 7. Verification Gates (for PROVE)

```bash
# Install
pip install -e "packages/ingestkit-forms[dev]"

# Run form tests
pytest packages/ingestkit-forms/tests -m unit -v

# Regression: run excel tests
pytest packages/ingestkit-excel/tests -m unit -v

# Import check
python -c "from ingestkit_forms.models import SourceFormat, FormTemplate, FormChunkMetadata; print('OK')"
python -c "from ingestkit_forms.errors import FormErrorCode, FormIngestError; print('OK')"
```

AGENT_RETURN: .agents/outputs/plan-57-021526.md
