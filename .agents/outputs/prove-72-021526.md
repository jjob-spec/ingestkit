---
issue: 72
agent: PROVE
date: 2026-02-15
status: PASS
tests_passed: 506
tests_failed: 0
regressions: 0
---

# PROVE Report: Issue #72 -- Pipeline Integration as Path F

## Executive Summary

All claims from PATCH #72 verified. `try_match()` returns `TemplateMatch | None` with zero state mutation on fallthrough. `match_document()` returns ranked matches with structured logging per spec 18.4. Logger name is `ingestkit_forms`. PII-safe logging enforced. 33 router tests pass, 506 total tests pass, zero regressions.

---

## Verification Gates

### Gate 1: Ruff Lint

```
$ ruff check packages/ingestkit-forms/src/ingestkit_forms/router.py
All checks passed!
```

**Result**: PASS

### Gate 2: test_router.py

```
$ python3 -m pytest packages/ingestkit-forms/tests/test_router.py -v --no-header -q
33 passed in 0.10s
```

**Result**: PASS -- 33 tests, all passing

### Gate 3: Full Suite

```
$ python3 -m pytest packages/ingestkit-forms/tests/ -q --no-header
506 passed, 2 warnings in 46.67s
```

**Result**: PASS -- 506 tests, zero failures, zero regressions (matches PATCH claim of 506)

---

## Acceptance Criteria

| Criterion | Status | Evidence |
|-----------|--------|---------|
| `try_match()` returns `TemplateMatch \| None` | PASS | router.py:177 return type annotation; tests confirm both paths |
| Zero state mutation on fallthrough | PASS | `test_try_match_no_state_mutation` verifies store/db/vs unchanged |
| `match_document()` returns ranked matches | PASS | router.py:126-170; delegates to FormMatcher with logging |
| Structured logging: template_candidates | PASS | `test_match_document_logs_structured` asserts field present |
| Structured logging: top_confidence | PASS | Same test; format `%.3f` in log |
| Structured logging: match_duration_ms | PASS | Same test; `time.monotonic()` timing |
| Structured logging: match_result | PASS | Values: "manual", "auto", "fallthrough" per code paths |
| PII-safe logging (no field values) | PASS | `test_pii_safe_logging` plants "SENSITIVE_PII_VALUE_12345", asserts absent from all log records |
| Logger name is `ingestkit_forms` | PASS | router.py:52; `test_logger_name` asserts `router_logger.name == "ingestkit_forms"` |
| Manual override: confidence=1.0 | PASS | router.py:209; `test_try_match_manual_template` asserts `result.confidence == 1.0` |
| Manual override: matched_features=["manual_override"] | PASS | router.py:211; same test asserts feature present |
| Auto-match: applies form_match_confidence_threshold (0.8) | PASS | router.py:224; `test_try_match_auto_below_threshold` returns None for empty store |
| Exception handling: returns None | PASS | `test_try_match_exception_returns_none` injects FailFingerprinter |
| try_match documented as non-protocol | PASS | Docstring: "convenience method for the orchestration layer (not part of the FormPluginAPI protocol)" |
| Extract-stage structured logging | PASS | `test_extract_form_extract_stage_log` verifies all fields present |

---

## Comparison with PATCH

All PATCH claims verified. No discrepancies found.

- PATCH claims 15 new tests: Verified (4 in TestMatchDocument + 6 in TestTryMatch + 5 in TestStructuredLogging = 15)
- PATCH claims 33 total router tests: Verified (pytest collected 33)
- PATCH claims 506 total suite: Verified (506 passed)

---

## Compliance Checklist

| Rule | Status |
|------|--------|
| Backend-agnostic core (Protocol types only) | PASS |
| Pydantic v2 models (TemplateMatch is BaseModel) | PASS |
| No ABC usage | PASS |
| Logger name `ingestkit_forms` | PASS |
| PII-safe logging | PASS |
| Fail-closed (fallthrough returns None) | PASS |

---

## Recommendation

**APPROVED** -- Issue #72 is complete and ready for merge.

AGENT_RETURN: prove-72-021526.md
