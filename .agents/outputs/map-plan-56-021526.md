---
issue: 56
agent: MAP-PLAN
date: 2026-02-15
complexity: SIMPLE
stack: backend
---

# MAP-PLAN: Issue #56 -- Scaffold ingestkit-forms package structure

**Issue:** #56 -- Scaffold `ingestkit-forms` package structure
**SPEC Section:** 4.4, 15.1
**Complexity:** SIMPLE
**Date:** 2026-02-15

---

## EXECUTIVE SUMMARY

Create the `packages/ingestkit-forms/` package directory structure following the spec section 4.4 module layout. The package needs a `pyproject.toml` with optional dependency groups (pdf, pdf-mit, ocr, ocr-lite, vlm, all, dev), core deps on pydantic/openpyxl/Pillow plus ingestkit-core, empty stub modules with docstrings for all files in the spec tree, and a conftest.py with fixture placeholders. The package must be installable via `pip install -e "packages/ingestkit-forms[dev]"`. Pattern follows existing ingestkit-excel and ingestkit-pdf packages.

---

## INVESTIGATION FINDINGS

### 1. Existing package patterns

Both `ingestkit-excel` and `ingestkit-pdf` follow the same structure:
- `pyproject.toml` at package root with setuptools build backend
- `src/ingestkit_{name}/` source tree with `__init__.py` exporting public API
- `tests/` directory with `__init__.py`, `conftest.py`, and `test_*.py` files
- `[tool.setuptools.packages.find]` with `where = ["src"]`
- `[tool.pytest.ini_options]` with testpaths and markers
- Version `0.1.0` for new packages
- `ingestkit-core>=0.1.0` as a core dependency

### 2. Spec section 4.4 module tree (line 248-285)

```
ingestkit-forms/
+-- pyproject.toml
+-- SPEC.md
+-- ROADMAP.md
+-- src/
|   +-- ingestkit_forms/
|       +-- __init__.py            # Exports: FormRouter, create_default_router
|       +-- protocols.py           # FormTemplateStore, OCRBackend
|       +-- models.py              # Pydantic models
|       +-- errors.py              # Normalized error codes
|       +-- config.py              # FormProcessorConfig
|       +-- idempotency.py         # Reuses IngestKey from ingestkit-core
|       +-- matcher.py             # Form Matcher
|       +-- router.py              # FormRouter orchestrator
|       +-- extractors/
|       |   +-- __init__.py
|       |   +-- native_pdf.py     # NativePDFExtractor
|       |   +-- ocr_overlay.py    # OCROverlayExtractor
|       |   +-- excel_cell.py     # ExcelCellExtractor
|       +-- output/
|       |   +-- __init__.py
|       |   +-- db_writer.py      # Structured DB row writer
|       |   +-- chunk_writer.py   # RAG chunk serializer + embedder
|       +-- api.py                 # Plugin API surface
+-- tests/
    +-- __init__.py
    +-- conftest.py
    +-- test_matcher.py
    +-- test_extractors.py
    +-- test_output.py
    +-- test_api.py
    +-- test_router.py
    +-- test_config.py
    +-- fixtures/                  # Sample form files directory
```

### 3. Spec section 15.1 dependencies (line 2086-2122)

Core deps: `pydantic>=2.0`, `openpyxl>=3.1`, `Pillow>=10.0`
Plus `ingestkit-core>=0.1.0` (following sibling package pattern, not in spec 15.1 but required per issue requirements and sibling pattern).

Optional groups per spec:
- `pdf`: `PyMuPDF>=1.24`
- `pdf-mit`: `pdfplumber>=0.11`, `pypdf>=4.0`
- `ocr`: `paddleocr>=2.7` (with platform marker)
- `ocr-lite`: `pytesseract>=0.3.10`
- `vlm`: `httpx>=0.27`
- `all`: `ingestkit-forms[pdf,ocr,vlm]`
- `dev`: `pytest>=7.0`, `pytest-cov`, `pyyaml>=6.0`

### 4. SPEC.md and ROADMAP.md

The issue says "per spec" but these are documentation files. Since the issue scope is scaffolding, we will NOT create SPEC.md or ROADMAP.md (the spec lives at `docs/specs/form-ingestor-plugin.md` and ROADMAP is deferred work). These can be added in a later issue if needed.

---

## IMPLEMENTATION PLAN

### File 1: `packages/ingestkit-forms/pyproject.toml`

**Change type:** Create new file

```toml
[build-system]
requires = ["setuptools>=68"]
build-backend = "setuptools.build_meta"

[project]
name = "ingestkit-forms"
version = "0.1.0"
description = "Template-driven form extraction plugin for ingestkit"
requires-python = ">=3.10"
dependencies = [
    "ingestkit-core>=0.1.0",
    "pydantic>=2.0",
    "openpyxl>=3.1",
    "Pillow>=10.0",
]

[project.optional-dependencies]
# PDF widget extraction — choose ONE based on licensing needs
pdf = ["PyMuPDF>=1.24"]
pdf-mit = ["pdfplumber>=0.11", "pypdf>=4.0"]

# OCR — choose ONE (or both; engine selected at runtime via config)
ocr = [
    "paddleocr>=2.7; platform_system != 'Darwin' or platform_machine != 'arm64'",
]
ocr-lite = ["pytesseract>=0.3.10"]

# VLM fallback — optional, for low-confidence OCR field re-extraction
vlm = ["httpx>=0.27"]

# Full install — all extraction capabilities
all = [
    "ingestkit-forms[pdf,ocr,vlm]",
]

# Development
dev = [
    "pytest>=7.0",
    "pytest-cov",
    "pyyaml>=6.0",
]

[tool.setuptools.packages.find]
where = ["src"]

[tool.pytest.ini_options]
testpaths = ["tests"]
markers = [
    "unit: Unit tests (no external services)",
    "integration: Integration tests (require external services)",
]
```

**Rationale:** Follows ingestkit-excel/pdf pattern exactly. Version 0.1.0 (consistent with sibling packages). Core deps from spec 15.1 plus ingestkit-core. Optional groups match spec 15.1 verbatim.

### File 2: `packages/ingestkit-forms/src/ingestkit_forms/__init__.py`

**Change type:** Create new file

```python
"""ingestkit-forms -- Template-driven form extraction plugin for ingestkit.

Public API exports for form template matching, extraction, and output.
Stub module -- implementations will be added in subsequent issues.
"""

__all__: list[str] = []
```

**Rationale:** Minimal stub. Exports will be added as modules are implemented. Follows docstring pattern from ingestkit-excel/pdf.

### File 3: `packages/ingestkit-forms/src/ingestkit_forms/protocols.py`

**Change type:** Create new file

```python
"""Backend protocols for ingestkit-forms.

Defines FormTemplateStore and OCRBackend protocols (spec section 15.3).
Concrete implementations are injected at construction time.
"""
```

### File 4: `packages/ingestkit-forms/src/ingestkit_forms/models.py`

**Change type:** Create new file

```python
"""Pydantic v2 data models for ingestkit-forms.

Defines FormTemplate, FieldMapping, BoundingBox, and all form-specific
data structures (spec section 5).
"""
```

### File 5: `packages/ingestkit-forms/src/ingestkit_forms/errors.py`

**Change type:** Create new file

```python
"""Normalized error codes for ingestkit-forms.

Extends the base error taxonomy from ingestkit-core with form-specific
error codes (spec section 14).
"""
```

### File 6: `packages/ingestkit-forms/src/ingestkit_forms/config.py`

**Change type:** Create new file

```python
"""FormProcessorConfig and configuration defaults.

All thresholds, model names, and tunable parameters for the form
processing pipeline (spec section 4.3).
"""
```

### File 7: `packages/ingestkit-forms/src/ingestkit_forms/idempotency.py`

**Change type:** Create new file

```python
"""Idempotency key computation for form ingestion.

Reuses the IngestKey pattern from ingestkit-core with form-specific
content hashing (spec section 4.2).
"""
```

### File 8: `packages/ingestkit-forms/src/ingestkit_forms/matcher.py`

**Change type:** Create new file

```python
"""Form Matcher: layout fingerprinting and template matching.

Compares incoming documents against registered FormTemplates using
structural fingerprints to select the best-matching template
(spec section 6).
"""
```

### File 9: `packages/ingestkit-forms/src/ingestkit_forms/router.py`

**Change type:** Create new file

```python
"""FormRouter: orchestrates matching, extraction, and output.

Entry point for the form processing pipeline. Routes matched forms
through the appropriate extractor and output writer (spec section 9).
"""
```

### File 10: `packages/ingestkit-forms/src/ingestkit_forms/api.py`

**Change type:** Create new file

```python
"""Plugin API surface for ingestkit-forms.

Provides template CRUD, preview, and matching endpoints consumed
by the orchestration layer (spec section 10).
"""
```

### File 11: `packages/ingestkit-forms/src/ingestkit_forms/extractors/__init__.py`

**Change type:** Create new file

```python
"""Form field extractors.

Subpackage containing extraction backends:
- native_pdf: PyMuPDF-based form widget extraction
- ocr_overlay: Template overlay + per-field OCR extraction
- excel_cell: openpyxl cell value mapping extraction
"""
```

### File 12: `packages/ingestkit-forms/src/ingestkit_forms/extractors/native_pdf.py`

**Change type:** Create new file

```python
"""NativePDFExtractor: PyMuPDF form field extraction.

Extracts values from fillable PDF form widgets using the PDFWidgetBackend
protocol. Supports text fields, checkboxes, radio buttons, dropdowns,
and signature fields (spec section 7).
"""
```

### File 13: `packages/ingestkit-forms/src/ingestkit_forms/extractors/ocr_overlay.py`

**Change type:** Create new file

```python
"""OCROverlayExtractor: render + template overlay + per-field OCR.

Renders PDF pages or processes scanned images, overlays the template
field regions, and runs OCR on each field's bounding box
(spec section 8).
"""
```

### File 14: `packages/ingestkit-forms/src/ingestkit_forms/extractors/excel_cell.py`

**Change type:** Create new file

```python
"""ExcelCellExtractor: openpyxl cell value mapping.

Reads form field values from Excel files using cell address mappings
defined in the FormTemplate (spec section 7.3).
"""
```

### File 15: `packages/ingestkit-forms/src/ingestkit_forms/output/__init__.py`

**Change type:** Create new file

```python
"""Output writers for extracted form data.

Subpackage containing:
- db_writer: Structured DB row writer
- chunk_writer: RAG chunk serializer + embedder
"""
```

### File 16: `packages/ingestkit-forms/src/ingestkit_forms/output/db_writer.py`

**Change type:** Create new file

```python
"""Structured DB row writer for extracted form data.

Writes validated form field values as structured rows to the
StructuredDBBackend (spec section 11).
"""
```

### File 17: `packages/ingestkit-forms/src/ingestkit_forms/output/chunk_writer.py`

**Change type:** Create new file

```python
"""RAG chunk serializer and embedder for form data.

Converts extracted form fields into ChunkPayload objects with
embeddings for vector store ingestion (spec section 11).
"""
```

### File 18: `packages/ingestkit-forms/tests/__init__.py`

**Change type:** Create new file (empty)

### File 19: `packages/ingestkit-forms/tests/conftest.py`

**Change type:** Create new file

```python
"""Shared test fixtures for ingestkit-forms tests.

Provides mock backends, test configuration, and fixture placeholders
for form template, PDF, Excel, and image test files.
"""

from __future__ import annotations

import pytest


# ---------------------------------------------------------------------------
# Configuration Fixtures
# ---------------------------------------------------------------------------


@pytest.fixture()
def form_config():
    """Return a FormProcessorConfig with all defaults.

    TODO: Replace with actual FormProcessorConfig once config.py is implemented.
    """
    return {}


# ---------------------------------------------------------------------------
# Mock Backend Fixtures (Placeholders)
# ---------------------------------------------------------------------------


@pytest.fixture()
def mock_template_store():
    """Mock FormTemplateStore for testing.

    TODO: Implement MockFormTemplateStore once protocols.py is implemented.
    """
    return None


@pytest.fixture()
def mock_ocr_backend():
    """Mock OCRBackend for testing.

    TODO: Implement MockOCRBackend once protocols.py is implemented.
    """
    return None


@pytest.fixture()
def mock_pdf_widget_backend():
    """Mock PDFWidgetBackend for testing.

    TODO: Implement MockPDFWidgetBackend once protocols.py is implemented.
    """
    return None


# ---------------------------------------------------------------------------
# Test File Fixtures (Placeholders)
# ---------------------------------------------------------------------------


@pytest.fixture()
def sample_pdf_form(tmp_path):
    """Generate a sample fillable PDF form for testing.

    TODO: Implement once extractors are built.
    """
    return tmp_path / "sample_form.pdf"


@pytest.fixture()
def sample_excel_form(tmp_path):
    """Generate a sample Excel form for testing.

    TODO: Implement once extractors are built.
    """
    return tmp_path / "sample_form.xlsx"


@pytest.fixture()
def sample_scanned_form(tmp_path):
    """Generate a sample scanned form image for testing.

    TODO: Implement once extractors are built.
    """
    return tmp_path / "sample_form.png"
```

**Rationale:** Follows the conftest.py pattern from ingestkit-excel/pdf with placeholder fixtures. Uses TODO markers for items to be filled in when modules are implemented.

### File 20: `packages/ingestkit-forms/tests/test_matcher.py`

**Change type:** Create new file

```python
"""Tests for the form matcher module."""
```

### File 21: `packages/ingestkit-forms/tests/test_extractors.py`

**Change type:** Create new file

```python
"""Tests for form field extractors."""
```

### File 22: `packages/ingestkit-forms/tests/test_output.py`

**Change type:** Create new file

```python
"""Tests for output writers (db_writer, chunk_writer)."""
```

### File 23: `packages/ingestkit-forms/tests/test_api.py`

**Change type:** Create new file

```python
"""Tests for the plugin API surface."""
```

### File 24: `packages/ingestkit-forms/tests/test_router.py`

**Change type:** Create new file

```python
"""Tests for FormRouter orchestrator."""
```

### File 25: `packages/ingestkit-forms/tests/test_config.py`

**Change type:** Create new file

```python
"""Tests for FormProcessorConfig."""
```

### File 26: `packages/ingestkit-forms/tests/fixtures/` (directory)

**Change type:** Create directory with `.gitkeep`

Empty directory for sample form files (PDF, Excel, images). A `.gitkeep` file ensures the directory is tracked by git.

---

## RISK ASSESSMENT

| Risk | Likelihood | Mitigation |
|------|-----------|------------|
| `ingestkit-core` not installed when running `pip install -e` | Low | It's in the monorepo; install core first or use `-e packages/ingestkit-core` |
| paddleocr platform marker syntax | Low | Copied verbatim from spec 15.1 |

## ESTIMATED EFFORT

- Files to create: 26 (1 pyproject.toml + 14 source stubs + 1 conftest + 7 test stubs + 1 fixtures dir + 2 `__init__.py`)
- Lines of code: ~250 (mostly docstrings and fixture placeholders)
- Complexity: SIMPLE -- no logic, all scaffolding
- Estimated time: 15-20 minutes

## ACCEPTANCE CRITERIA

- [ ] Directory structure matches spec section 4.4 tree
- [ ] `pyproject.toml` has correct build-system, project metadata, and all 7 optional dependency groups (pdf, pdf-mit, ocr, ocr-lite, vlm, all, dev)
- [ ] Core deps include `ingestkit-core>=0.1.0`, `pydantic>=2.0`, `openpyxl>=3.1`, `Pillow>=10.0`
- [ ] All source modules from spec tree exist with docstrings
- [ ] `extractors/` and `output/` subpackages have `__init__.py` files
- [ ] `tests/conftest.py` has fixture placeholders for mock backends and test files
- [ ] All test stub files from spec tree exist
- [ ] `tests/fixtures/` directory exists
- [ ] Package installs successfully: `pip install -e "packages/ingestkit-forms[dev]"`
- [ ] `python -c "import ingestkit_forms"` succeeds after installation

## VERIFICATION GATES (for PROVE)

```bash
# Install
pip install -e "packages/ingestkit-forms[dev]"

# Import check
python -c "import ingestkit_forms; print('OK')"

# Verify all modules importable
python -c "
import ingestkit_forms
import ingestkit_forms.protocols
import ingestkit_forms.models
import ingestkit_forms.errors
import ingestkit_forms.config
import ingestkit_forms.idempotency
import ingestkit_forms.matcher
import ingestkit_forms.router
import ingestkit_forms.api
import ingestkit_forms.extractors
import ingestkit_forms.extractors.native_pdf
import ingestkit_forms.extractors.ocr_overlay
import ingestkit_forms.extractors.excel_cell
import ingestkit_forms.output
import ingestkit_forms.output.db_writer
import ingestkit_forms.output.chunk_writer
print('All modules importable')
"

# Run tests (should pass with 0 collected since stubs are empty)
pytest packages/ingestkit-forms/tests -v
```

AGENT_RETURN: .agents/outputs/map-plan-56-021526.md
