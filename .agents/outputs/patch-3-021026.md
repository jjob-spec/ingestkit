---
issue: 3
agent: PATCH
date: 2026-02-10
status: Complete
files_modified: 0
files_created: 10
tests_added: 131
---

# PATCH - Issue #3

## Summary

Scaffolded the `ingestkit-excel` package from scratch, implementing the full foundation layer specified in SPEC.md. Created `pyproject.toml` with setuptools build system, core dependencies (openpyxl, pandas, pydantic), and optional dependency groups (qdrant, ollama, postgres, dev). Implemented all 5 domain enums using `(str, Enum)` to prevent the ENUM_VALUE failure pattern, the `IngestKey` model with deterministic SHA-256 composite hashing, 3 typed stage-artifact models, and 8 core Pydantic v2 models. Implemented the complete error taxonomy with 26 `ErrorCode` enum members (20 errors + 6 warnings) and the `IngestError` model. Implemented `ExcelProcessorConfig` with all 27 fields matching spec defaults exactly, plus `from_file()` supporting YAML and JSON. Implemented 4 `@runtime_checkable` Protocols for backend abstraction. All 131 tests pass with zero warnings.

## Pre-Flight
- [x] Read MAP-PLAN (`map-plan-3-021026.md`)
- [x] Read spec (SPEC.md sections 3, 4, 5, 11, 18)
- [x] Branch: `feature/issue-3-foundation-models` (confirmed, not main)

## Files Created

| # | File | Description |
|---|------|-------------|
| 1 | `packages/ingestkit-excel/pyproject.toml` | Build system (setuptools), dependencies, optional deps, pytest config, package discovery |
| 2 | `packages/ingestkit-excel/src/ingestkit_excel/__init__.py` | Public API exports for all models, enums, errors, config, protocols |
| 3 | `packages/ingestkit-excel/src/ingestkit_excel/models.py` | 5 enums, IngestKey, 3 stage artifacts, 8 core models |
| 4 | `packages/ingestkit-excel/src/ingestkit_excel/errors.py` | ErrorCode enum (26 codes), IngestError model |
| 5 | `packages/ingestkit-excel/src/ingestkit_excel/config.py` | ExcelProcessorConfig (27 fields), from_file() classmethod |
| 6 | `packages/ingestkit-excel/src/ingestkit_excel/protocols.py` | 4 runtime_checkable Protocols (VectorStore, StructuredDB, LLM, Embedding) |
| 7 | `packages/ingestkit-excel/tests/__init__.py` | Test package marker |
| 8 | `packages/ingestkit-excel/tests/conftest.py` | Shared fixtures (sample_config, sample_ingest_key) |
| 9 | `packages/ingestkit-excel/tests/test_models.py` | Enum value tests, IngestKey determinism, model instantiation, protocol runtime checks |
| 10 | `packages/ingestkit-excel/tests/test_config.py` | Default value tests, from_file() JSON/YAML, ErrorCode completeness |

## Verification
- `pip install -e ".[dev]"`: PASS
- `pytest -q`: 131/131 passing, 0 warnings

## Issues Encountered
- The initial `build-backend` in pyproject.toml used `setuptools.backends._legacy:_Backend` which does not exist. Corrected to `setuptools.build_meta`.
- Pydantic v2.11+ deprecates accessing `model_fields` on instances (vs. the class). Fixed the test to access it on the class directly.

## Deviations from PLAN
- Tests placed at `packages/ingestkit-excel/tests/` (outside `src/`) per MAP-PLAN recommendation, rather than `src/ingestkit_excel/tests/` shown in spec section 2.3. This is standard Python packaging practice for editable installs.
- The MAP-PLAN mentions 22 error codes; the actual spec section 4.1 defines 20 error codes + 6 warning codes = 26 total. Implemented all 26 as specified.

---
AGENT_RETURN: patch-3-021026.md
