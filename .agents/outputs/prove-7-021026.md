# PROVE Report: Issue #7 -- Tier 2/3 LLM Classifier

**Verdict: PASS**

**Date**: 2026-02-10
**Agent**: PROVE
**Package**: `ingestkit-excel`

---

## 1. Test Suite

**Result**: ALL 276 TESTS PASSED (0.48s)

```
tests/test_config.py           -- 39 passed
tests/test_idempotency.py      -- 14 passed
tests/test_inspector.py        -- 28 passed
tests/test_llm_classifier.py   -- 48 passed
tests/test_models.py           -- 42 passed
tests/test_parser_chain.py     -- 19 passed
```

No failures, no warnings, no skips.

---

## 2. Implementation Structure (`llm_classifier.py`)

| Required Component                     | Status  | Location (line) |
|----------------------------------------|---------|-----------------|
| `LLMClassificationResponse` Pydantic   | PRESENT | L41-53          |
| `Literal["tabular_data", ...]`         | PRESENT | L49, L52        |
| `LLMClassifier` class                  | PRESENT | L82             |
| `classify(profile, tier)` method       | PRESENT | L100-244        |
| `_generate_structural_summary()`       | PRESENT | L248-309        |
| `_validate_and_parse_response()`       | PRESENT | L350-405        |
| Retry logic (2 attempts)               | PRESENT | L136-224        |
| Fail-closed (confidence=0.0)           | PRESENT | L237-244        |
| `_build_classification_prompt()`       | PRESENT | L311-348        |
| `_to_classification_result()`          | PRESENT | L407-438        |
| `_redact()`                            | PRESENT | L440-452        |

---

## 3. ENUM_VALUE Compliance

| Check                                                          | Status |
|----------------------------------------------------------------|--------|
| Literal types use `"tabular_data"`, `"formatted_document"`, `"hybrid"` | PASS   |
| FileType() called with value form: `FileType(response.type)`  | PASS   |
| No `FileType["TABULAR_DATA"]` name-form usage                 | PASS   |
| Literal values match `FileType` enum values exactly            | PASS   |
| `sheet_types` Literal excludes `"hybrid"` (correct constraint) | PASS   |

---

## 4. VERIFICATION_GAP Compliance

| Check                                                        | Status |
|--------------------------------------------------------------|--------|
| All LLM output goes through Pydantic `LLMClassificationResponse(**raw)` | PASS |
| Confidence bounds manually checked and clamped (L381-393)    | PASS   |
| OOB confidence generates `E_LLM_CONFIDENCE_OOB` warning      | PASS   |
| OOB confidence does NOT trigger retry (clamp only)           | PASS   |
| Fail-closed after max retries: confidence=0.0, reasoning mentions failure | PASS |
| `ValueError` raised for `ClassificationTier.RULE_BASED`     | PASS   |
| JSON decode errors caught and retried                        | PASS   |
| Schema validation errors caught and retried                  | PASS   |
| Timeout errors caught and retried                            | PASS   |
| Generic exceptions caught and retried                        | PASS   |

---

## 5. Exports

`LLMClassifier` is exported in `__init__.py` (L31) and included in `__all__` (L68).

---

## 6. Test Coverage

| Required Test Scenario                                         | Test(s)                                          | Status |
|----------------------------------------------------------------|--------------------------------------------------|--------|
| Valid response -> correct ClassificationResult                 | `TestValidResponseParsing` (7 tests)             | PASS   |
| Malformed JSON -> E_LLM_MALFORMED_JSON + retry                | `TestMalformedJsonRetry` (4 tests)               | PASS   |
| Schema invalid -> E_LLM_SCHEMA_INVALID + retry                | `TestSchemaValidation` (6 tests)                 | PASS   |
| Confidence OOB -> clamp + E_LLM_CONFIDENCE_OOB warning        | `TestConfidenceBounds` (5 tests)                 | PASS   |
| 2 failures -> fail-closed (confidence 0.0)                    | `TestFailClosed` (3 tests)                       | PASS   |
| Structural summary has no raw values by default                | `test_summary_contains_no_raw_values_by_default` | PASS   |
| Tier 2 uses classification_model                              | `test_tier2_uses_classification_model`           | PASS   |
| Tier 3 uses reasoning_model                                   | `test_tier3_uses_reasoning_model`                | PASS   |
| Timeout handling                                               | `TestTimeoutHandling` (2 tests)                  | PASS   |
| Prompt content correctness                                     | `TestPromptContent` (5 tests)                    | PASS   |
| Cell type inference                                            | `TestCellTypeInference` (7 tests)                | PASS   |
| LLMClassificationResponse model validation                    | `TestLLMClassificationResponseModel` (5 tests)   | PASS   |

Total LLM classifier tests: **48**

---

## 7. Smoke Test

```
Type: tabular_data, Confidence: 0.85, Tier: llm_basic
SMOKE TEST PASSED
```

End-to-end flow verified: MockLLM -> LLMClassifier.classify() -> ClassificationResult with correct values.

---

## Summary

All verification steps pass. The Tier 2/3 LLM classifier implementation is correct, complete, and fully tested. ENUM_VALUE and VERIFICATION_GAP patterns are properly addressed with no violations found.
