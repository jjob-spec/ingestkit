---
issue: 31
agent: PROVE
date: 2026-02-14
status: PASS
tests_passed: 27
tests_failed: 0
regressions: 0
---

# PROVE: Issue #31 -- Heading Hierarchy Detection

## Executive Summary

All 27 unit tests pass for `HeadingDetector`. The full PDF test suite (299 tests) passes with zero regressions. Linting is clean. All acceptance criteria are met. Implementation matches the MAP-PLAN specification.

## Verification Results

| Check | Result |
|-------|--------|
| `pytest test_heading_detector.py -v` | 27 passed in 0.23s |
| `pytest packages/ingestkit-pdf/tests/ -q` | 299 passed in 0.56s |
| `ruff check heading_detector.py` | All checks passed |

## Acceptance Criteria

| Criterion | Status |
|-----------|--------|
| PDFs with bookmarks: headings extracted from outline | PASS |
| PDFs without bookmarks: headings inferred from font sizes | PASS |
| Bold, larger text correctly identified as headings | PASS |
| H1/H2/H3 hierarchy correctly mapped | PASS |
| `get_heading_path` returns correct ancestry | PASS |
| Fallback chain: outline, font-based, markdown | PASS |
| Tests pass, lint passes | PASS |

## Comparison with PATCH

All PATCH claims verified. No discrepancies found.

- Files created: 2 (heading_detector.py, test_heading_detector.py) -- confirmed
- Files modified: 1 (utils/__init__.py) -- confirmed, exports both `HeaderFooterDetector` and `HeadingDetector`
- Tests added: 27 -- confirmed, all passing
- No regressions in existing 272 tests

## Spot-Check Notes

- `detect()` correctly cascades through three strategies and returns on first non-empty result
- Internal 4-tuple storage `(level, title, page, y_pos)` properly stripped to 3-tuple for public API
- `get_heading_path()` builds ancestry by walking backward through heading levels
- Font-based detection requires both bold flag AND size threshold -- non-bold large text is correctly excluded
- Markdown strategy uses lazy import of `pymupdf4llm` with graceful fallback
- All exceptions caught and logged as warnings; empty list returned on failure (fail-closed)
- Logger name is `ingestkit_pdf` -- correct

## Recommendation

**APPROVED** -- Ready for PR.

AGENT_RETURN: .agents/outputs/prove-31-021426.md
